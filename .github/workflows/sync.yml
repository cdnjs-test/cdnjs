name: sync

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:
    inputs:
      push_freq:
        description: 'Push frequency'
        type: number
        required: true

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
     - name: clone
       run: |
         git clone \
           --depth 1  \
           --filter=blob:none \
           --sparse \
           https://${{ github.token }}@github.com/cdnjs-test/cdnjs.git

     - name: sync
       env:
         PUSH_FREQ: ${{ inputs.push_freq || 5 }}
       run: |
         wget https://github.com/cdnjs/tools/releases/download/ccedb06b7bbe3d3db7964f5c54560b372c1a8bc13/git-sync
         chmod +x ./git-sync
         cd cdnjs
         git config user.name robocdnjs
         git config user.email cdnjs-github@cloudflare.com
         ../git-sync ./last-sync cdnjs-outgoing-staging
         
     - name: push
       run: |
         cd cdnjs
         git push https://${{ github.actor }}:${{ github.token }}@github.com/cdnjs-test/cdnjs.git
